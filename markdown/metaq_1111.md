### MetaQ的角色  
MetaQ是阿里自主研发的一款消息中间件产品，提供可靠的消息服务和高效堆积，主要用在数据分发，商家服务，实时计算，交易流程等领域，在阿里内部使用广泛。

### 双十一的挑战  
双十一购物狂欢节无论是业务总量还是峰值都比平时翻很多倍，如何保证服务的高效可用，上下游处理能力的不匹配，如何保证数据的可靠高效堆积，如何解决数据热点，低延迟，无疑对一些基础服务系统带来很大的挑战

### 双十一前的准备  
- 升级老客户端  
大促前将所有使用老客户端版本的应用升级到新客户端，避免低版本客户端的一些已知问题给系统稳定性带来影响  
- 容量评估  
对所有的业务方进行容量评估，按需对不同的集群进行扩容； 拆分公有集群，将消息量大的业务独立集群，不同级别的业务互不影响  
- 完善监控  
细化业务数据的监控统计，完善监控报警，做到可动态调整
- 针对不同集群运行参数调优  
根据业务的特点，对不同集群broker运行参数调优，如批量拉取大小，刷盘方式，数据有效期等等； 同时对io调度，虚拟内存参数进行调优提供高效堆积  
- 全链路压测  
模拟预估的峰值流量，以接近真实业务数据贯穿整个交易流程进行压测，验证是否满足预期，预案执行是否顺畅。  
压测过程中也暴露系统的问题如：zk session失效问题，以及频繁full gc问题；通过限流避免资源的过渡争用，避免影响集群服务能力  
数据热点，压测过程中还暴露了数据分布不均匀的问题，不同机器qps分摊不均匀；由于这部分数据和具体业务紧密联系所以业务作出一些调整，对数据的分布进行rehash  
- 工具完善  
集群批量执行功能，预案执行工具等  

### 达到的效果  
活动当天总消息写入量140亿，投递量260亿，前期准备还比较充分，活动当天高峰期平稳度过，全天表现很平稳，部分消费组上亿消息堆积对集群影响不大。75%的交易在聚石塔上完成提供强力支持，实时直播间交易统计延迟在1s左右，加减库存做到零超卖。

just test haha
